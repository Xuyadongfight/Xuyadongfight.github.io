Swift中的类型分为两类值类型和引用类型

## 值类型
值类型是每个实例都保留其数据的唯一副本。意味着每个实例间的数据互不影响。通常为结构体，枚举或元组。

## 引用类型
引用类型是实例共享数据的单个副本。并且类型通常定义为类。意味着实例间的数据会相互影响。

## 区别
值类型最基本的特征是复制——赋值、初始化和参数传递的效果——创建一个独立的实例，它拥有自己唯一的数据副本:
```
// Value type example
struct S { var data: Int = -1 }
var a = S()
var b = a						// a is copied to b
a.data = 42						// Changes a, not b
println("\(a.data), \(b.data)")	// prints "42, -1"
```
另一方面，复制引用类型会隐式地创建一个共享实例。拷贝后，两个变量引用数据的单个实例，因此修改第二个变量中的数据也会影响原始数据，例如:
```
// Reference type example
class C { var data: Int = -1 }
var x = C()
var y = x						// x is copied to y
x.data = 42						// changes the instance referred to by x (and y)
println("\(x.data), \(y.data)")	// prints "42, 42"
```

## 变化在安全性中的影响
选择值类型而不是引用类型的主要原因之一是能够更容易地推断代码。如果你总是得到一个唯一的，复制的实例，你可以相信你的应用程序的其他部分不会改变隐藏的数据。这在多线程环境中特别有用，因为在多线程环境中，不同的线程可能会更改您的数据。这可能会产生非常难以调试的严重错误。
由于差异是根据更改数据时发生的情况来定义的，因此存在值类型和引用类型重叠的一种情况:当实例没有可写数据时。在没有突变的情况下，值和引用的行为完全相同。

## 怎么选择值类型还是引用类型
以下情况使用值类型:
* 使用==比较实例数据是有意义的
* 你希望copy的副本具有独立的状态
* 数据将在代码中跨线程使用

以下情况使用引用类型:
* 使用===比较实例是有意义的
* 你希望创建共享的可变状态

## 值类型的特点
值类型存储在栈中。你可以把变量看作是堆叠在一起的。
* 对栈的访问非常快
* 最后分配的值类型将是第一个被释放的。栈的后进先出
* 分配发生在你的应用被编译的时候。

## 引用类型的特点
引用类型存储在堆中
* 堆中的引用类型只有在没有引用计数时才会被释放。
* 访问堆内存比访问栈内存要慢一点。
* 堆里的对象可以随机访问。
* 堆里的对象可以随机移除。
* 随着对象的添加和删除而增长和缩小。
* 分配发生在应用程序运行时。

## 扩展写时复制
我们知道集合类型都是值类型，当其通过赋值或者作为参数时，会被复制。在Swift中，当你有较大的值类型，并且必须将其作为参数赋值或传递给函数时，复制它在性能方面可能会非常昂贵，因为你必须将所有底层数据复制到内存中的另一个位置。
为了尽量减少这个问题，Swift标准库为一些值类型实现了这组机制，比如Array，值只会在变化时被复制，即使这样，也只有当它有多个引用时才会被复制，因为如果这个值是唯一引用的，它不需要复制，它可以在引用上被改变。所以，只是赋值给一个变量或传递一个数组给一个函数并不一定意味着它会被复制这确实提高了性能。
写时复制并不是值类型的默认行为，而是在Swift标准库中为某些类型(如Array和Collections)实现的。因此，这意味着并不是标准库中的每个值类型都有这种行为。

## 思考问题
1. 值类型包含引用类型或引用类型包含值类型时的复制情况是什么样的?
值类型包含引用属性的赋值。只会复制值属性。对于引用属性不会复制。
引用类型包含值属性的赋值。因为外层本来就是引用类型。赋值只会赋值引用。自然不管属性是值属性还是引用属性都不会复制。

2. 如果在引用类型中声明值类型会怎样?
那么，如果一个类(引用类型)在其中声明了一些bool和int(值类型)又会怎样呢?这是一个常见的场景。值类型可以封装在引用类型中，并驻留在堆中。

3. 如果将值类型传入闭包会怎样?
闭包是引用类型。这意味着它们生活在堆中。值类型将被移动到堆中，以便闭包可以在闭包的生命周期内访问它。

## 参考
1. https://developer.apple.com/swift/blog/?id=10
2. https://medium.com/@lucianoalmeida1/understanding-swift-copy-on-write-mechanisms-52ac31d68f2f

